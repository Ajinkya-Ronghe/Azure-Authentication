SELECT 
    c.priority, 
    c.incident_number,
    c.short_description,
    COUNT(CASE WHEN LOWER(i.bridge_type) LIKE '%mim%' THEN 1 END) AS mim_count,
    COUNT(CASE WHEN LOWER(i.bridge_type) LIKE '%tech%' OR LOWER(i.bridge_type) LIKE '%eas%' THEN 1 END) AS tech_eas_count,
    COUNT(CASE WHEN LOWER(i.bridge_type) LIKE '%bims%' THEN 1 END) AS bims_count
FROM 
    esh_main.ceh_warroom_ongoing_critical_details c
LEFT JOIN 
    esh_main.ceh_warroom_incident_details i
ON 
    c.incident_number = i.incident_number
WHERE 
    LOWER(c.priority) IN ('p1', 'p2', 'p3')
GROUP BY 
    c.priority, 
    c.incident_number,
    c.short_description;
